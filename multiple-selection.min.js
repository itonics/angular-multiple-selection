function offset(e){var t,l={top:0,left:0},i=e&&e.ownerDocument;return t=i.documentElement,void 0!==typeof e.getBoundingClientRect&&(l=e.getBoundingClientRect()),{top:l.top+(window.pageYOffset||t.scrollTop)-(t.clientTop||0),left:l.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}}angular.module("multipleSelection",[]).directive("multipleSelectionItem",["$timeout",function(e){return{restrict:"A",require:["^multipleSelectionZone"],controller:function(e){},link:function(t,l,i,n){function c(){t.linkTriggered=!1,t.allSelectables=a.getAllSelectables(),t.itemData={},t.itemData.uri=i.multipleSelectionItem?t.$eval(i.multipleSelectionItem):Math.round(99999*Math.random()),t.itemData.id=t.allSelectables.length+"_"+t.itemData.uri,t.itemData.type=i.multiSelItemType&&"undefined"!=typeof i.multiSelItemType?t.$eval(i.multiSelItemType):"";var n={},c={};t.itemData.element||(t.itemData.element=[]),t.itemData.element.push(l),a.populate(t.itemData),t.$watchGroup([function(){return t.itemData.selecting},function(){return t.itemData.selected}],function(e){e[0]?l.addClass(s):l.removeClass(s),e[1]?l.addClass(o):l.removeClass(o)}),l.on("mousedown.multi-select",function(e,l){n={x:e.clientX,y:e.clientY},l&&"object"==typeof l&&(n={x:l.clientX,y:l.clientY}),a.childItemClicked=t.mouseDown=!0,(!a.enableItemDragSelection||t.itemData.selected)&&(e.preventDefault(),e.stopPropagation())}),l.on("mouseup.multi-select touchend.multi-select",function(e,l){return c={x:e.clientX,y:e.clientY},l&&"object"==typeof l&&(c={x:l.clientX,y:l.clientY},e.which=l.which),t.linkTriggered?void(t.linkTriggered=!1):void(1==e.which&&(a.continuousSelection?(n.x===c.x||n.y===c.y)&&(t.itemData.selected=!t.itemData.selected):t.itemData.selected?e.ctrlKey?t.itemData.selected=!1:a.deselectAll(t.itemData.id):(e.ctrlKey||a.isDragSelection||a.deselectAll(t.itemData.id),t.itemData.selected=!0),t.mouseDown=a.childItemClicked=a.isDragSelection=!1,t.linkTriggered=!1,a.updateSelectedData(t.itemData)))}),l.on("click mousedown mouseup touchstart touchend","a",function(l){"mousedown"===l.type&&(a.enableItemDragSelection&&l.stopPropagation(),t.linkTriggered=!0,e(function(){t.linkTriggered=!1},500)),"mouseup"===l.type&&e(function(){t.linkTriggered=!1},10)}),t.$on("$destroy",function(){a.remove(t.itemData)})}var a=n[0],s=a.selectingClass||"isSelecting",o=a.selectedClass||"isSelected";a.multipleSelectionZone===!1||"false"===a.multipleSelectionZone||c()}}}]).directive("multipleSelectionZone",["$document","$timeout","$parse",function(e,t,l){return{restrict:"A",scope:{selectedData:"=?",multipleSelectionZone:"@"},controller:function(e){function t(){e.allSelectables=[],l.selectingClass=e.selectingClass="",l.selectedClass=e.selectedClass="",l.continuousSelection=e.continuousSelection=!1,l.enableItemDragSelection=e.enableItemDragSelection=!1,l.isDragSelection=!1,l.childItemClicked=!1,l.selectionEvtEmitDisabled=e.selectionEvtEmitDisabled=!1,l.selectItem=e.selectItem=function(t){_.where(e.allSelectables,{id:t})[0].selected=!1},l.getAllSelectables=e.getAllSelectables=function(){return e.allSelectables},l.getSelectedData=e.getSelectedData=function(){return e.selectedData},l.setSelectedData=e.setSelectedData=function(t){e.selectedData="undefined"==typeof t?[]:t},l.updateSelectedData=e.updateSelectedData=function(t){for(var l=!1,i=null,n=e.selectedData,c=0;c<n.length;c++)if(n[c].id==t.id){i=c,l=!0;break}t.selected&&!l?n.push(t):!t.selected&&l&&n.splice(i,1),e.selectedData=n},l.setAllSelected=e.setAllSelected=function(){for(var t=[],l=e.allSelectables,i=0;i<l.length;i++)_.where(e.allSelectables,{id:l[i].id})[0].selected&&t.push(_.where(e.allSelectables,{id:l[i].id})[0]);e.selectedData=t},l.populate=e.populate=function(t){e.allSelectables.push(t)},l.deselectAll=e.deselectAll=function(t){t=Array.isArray(t)?t:[t];var l=e.allSelectables;e.selectedData=[];for(var i=0;i<l.length;i++)"undefined"==typeof t||-1===t.indexOf(l[i].id)?(_.where(e.allSelectables,{id:l[i].id})[0].selecting=!1,_.where(e.allSelectables,{id:l[i].id})[0].selected=!1):(_.where(e.allSelectables,{id:t[t.indexOf(l[i].id)]})[0].selected=!0,e.selectedData.push(_.where(e.allSelectables,{id:t[t.indexOf(l[i].id)]})[0]))},l.selectAll=e.selectAll=function(){var t=e.allSelectables,l=[];if(t.length){for(var i=0;i<t.length;i++)_.where(e.allSelectables,{id:t[i].id})[0].selecting=!1,_.where(e.allSelectables,{id:t[i].id})[0].selected=!0,l.push(_.where(e.allSelectables,{id:t[i].id})[0]);e.selectedData=l}},l.isElemVisible=e.isElemVisible=function(e){var t=!0;return(e.prop("offsetWidth")<=0||e.prop("offsetHeight")<=0||offset(e[0]).left+e.prop("offsetWidth")<0||offset(e[0]).top+e.prop("offsetHeight")<0||!e.is(":visible")||parseFloat(e.css("opacity"))<=0||"none"===e.css("display"))&&(t=!1),t},l.remove=e.remove=function(t){e.allSelectables=_.reject(e.allSelectables,{id:t.id})},l.onLinkEvtTrigger=e.onLinkEvtTrigger=function(e){}}this.multipleSelectionZone=e.multipleSelectionZone;var l=this;"false"===e.multipleSelectionZone||e.multipleSelectionZone===!1||t()},link:function(l,i,n,c){function a(){function a(e,t){return(t.beginX<=e.beginX&&e.beginX<=t.endX||e.beginX<=t.beginX&&t.beginX<=e.endX)&&(t.beginY<=e.beginY&&e.beginY<=t.endY||e.beginY<=t.beginY&&t.beginY<=e.endY)}function s(e,t,l,i){var n={};return e>l?(n.beginX=l,n.endX=e):(n.beginX=e,n.endX=l),t>i?(n.beginY=i,n.endY=t):(n.beginY=t,n.endY=i),n}function o(e,t,l,i,n){var c=s(t,l,i,n);u.css({top:c.beginY+"px",left:c.beginX+"px",width:c.endX-c.beginX+"px",height:c.endY-c.beginY+"px"})}function d(e){function t(e){var t=0;return _.each(e,function(e){l.isElemVisible(e)&&a(s(offset(e[0]).left,offset(e[0]).top,offset(e[0]).left+e.prop("offsetWidth"),offset(e[0]).top+e.prop("offsetHeight")),s(f,m,n,c))&&t++}),t>0}var n=e.pageX;n=n<offset(i[0]).left?offset(i[0]).left:n,n=n>offset(i[0]).left+i.prop("offsetWidth")?offset(i[0]).left+i.prop("offsetWidth"):n;var c=e.pageY;c=c<offset(i[0]).top?offset(i[0]).top:c,c=c>offset(i[0]).top+i.prop("offsetHeight")?offset(i[0]).top+i.prop("offsetHeight"):c,o(u,f,m,n,c);for(var d=l.allSelectables,r=0;r<d.length;r++){_.where(l.allSelectables,{id:d[r].id});t(d[r].element)?_.where(l.allSelectables,{id:d[r].id})[0].selecting=!0:(_.where(l.allSelectables,{id:d[r].id})[0].selected=!1,_.where(l.allSelectables,{id:d[r].id})[0].selecting=!1)}}function r(t){t.preventDefault(),u.remove();for(var i=l.allSelectables,n=0;n<i.length;n++){var a=_.where(l.allSelectables,{id:i[n].id});_.where(l.allSelectables,{id:i[n].id})[0].selecting===!0&&(_.where(l.allSelectables,{id:i[n].id})[0].selecting=!1,_.where(l.allSelectables,{id:i[n].id})[0].selected=t.ctrlKey?!a.selected:!0,l.updateSelectedData(_.where(l.allSelectables,{id:i[n].id})[0])),c.isDragSelection=!1}c.childItemClicked&&(c.childItemClicked=!1),e.off("mousemove.multi-select",d),e.off("mouseup.multi-select",r)}l.isSelectableZone=!0,l.selectionZoneOffset=offset(i[0]),"undefined"!=typeof n.continuousSelection&&(c.continuousSelection=l.continuousSelection=!0),n.selectingClass&&"string"==typeof n.selectingClass&&(c.selectingClass=l.selectingClass=n.selectingClass),n.selectedClass&&"string"==typeof n.selectedClass&&(c.selectedClass=l.selectedClass=n.selectedClass),"undefined"!=typeof n.enableItemDragSelection&&(c.enableItemDragSelection=l.enableItemDragSelection=!0),"undefined"!=typeof n.disableSelectionEvtEmit&&"false"!==n.disableSelectionEvtEmit&&(c.selectionEvtEmitDisabled=l.selectionEvtEmitDisabled=!0);var u,f=0,m=0;l.$watchCollection(function(){return l.selectedData},function(e,i){angular.equals(e,i)||e.length==i.length||(_.each(l.allSelectables,function(e){var t=_.where(l.selectedData,{id:e.id});e.selected=t&&t.length}),!l.selectionEvtEmitDisabled&&l.selectedData&&l.selectedData.length&&t(function(){l.$emit("MULTISEL_UPDATED",l.selectedData)}))}),l.$on("MULTISEL_SELECT_ALL",l.selectAll),l.$on("MULTISEL_SELECT_NONE",l.deselectAll),l.$on("MULTISEL_UPDATE",function(e,t){var i=_.where(l.allSelectables,{uri:t})[0].id;l.deselectAll(i)}),l.$on("MULTISEL_RESET_CLICKSTATE",function(){c.childItemClicked=!1}),i.on("mousedown.multi-select",function(t){t.preventDefault(),c.isDragSelection=!0,(!l.enableItemDragSelection&&!t.ctrlKey||l.enableItemDragSelection&&!c.childItemClicked&&!t.ctrlKey)&&l.deselectAll(),f=t.pageX,m=t.pageY,u=angular.element(".select-helper"),u.length||(u=angular.element("<div></div>").addClass("select-helper")),e.find("body").eq(0).append(u),e.on("mousemove.multi-select",d),e.on("mouseup.multi-select",r)}),l.$on("$destroy",function(){e.off("mousemove.multi-select",d),e.off("mouseup.multi-select",r)})}"false"===l.multipleSelectionZone||l.multipleSelectionZone===!1||a()}}}]);