/*! angular-multiple-selection 0.0.3 */
function offset(a){var b,c={top:0,left:0},d=a&&a.ownerDocument;return b=d.documentElement,void 0!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect()),{top:c.top+(window.pageYOffset||b.scrollTop)-(b.clientTop||0),left:c.left+(window.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}}angular.module("multipleSelection",[]).factory("multipleSelectionService",function(){return{allSelectables:[],selectedItems:[],continuousSelection:!1}}).directive("multipleSelectionItem",["multipleSelectionService",function(a){return{scope:!1,restrict:"A",require:"^multipleSelectionZone",controller:function(b){b.msService=a},link:function(a,b,c,d){a.isSelecting=!1,a.isSelected=!1,a.isSelectable=!0,a.isSelectable&&a.msService.allSelectables.push(b),b.on("mousedown",function(a){a.preventDefault(),a.stopPropagation()}),b.on("mouseup touchend",function(c){if(1==c.which)if(a.msService.continuousSelection)b.scope().isSelected?(b.scope().isSelected=!1,b.scope().$apply()):(b.scope().isSelected=!0,b.scope().$apply()),d.updateSelection();else{if(b.scope().isSelected)c.ctrlKey&&(b.scope().isSelected=!1,b.scope().$apply());else{if(!c.ctrlKey)for(var e=a.msService.allSelectables,f=0;f<e.length;f++)e[f].scope().isSelectable&&(e[f].scope().isSelecting===!0||e[f].scope().isSelected===!0)&&(e[f].scope().isSelecting=!1,e[f].scope().isSelected=!1,e[f].scope().$apply());b.scope().isSelected=!0,b.scope().$apply()}d.updateSelection()}c.stopPropagation()}),b.on("click mousedown touchend","a",function(a){a.stopPropagation()})}}}]).directive("multipleSelectionZone",["$document","$timeout","multipleSelectionService",function(a,b,c){return{restrict:"A",scope:{selectedItems:"="},controller:function(a){a.selectedItems=[],a.msService=c,this.updateSelection=a.updateSelection=function(){for(var c=a.msService.allSelectables,d=[],e=0;e<c.length;e++)c[e].scope().isSelected&&d.push(c[e]);b(function(){a.selectedItems=a.msService.selectedItems=d},1)}},link:function(b,c,d,e){function f(a,b){return(b.beginX<=a.beginX&&a.beginX<=b.endX||a.beginX<=b.beginX&&b.beginX<=a.endX)&&(b.beginY<=a.beginY&&a.beginY<=b.endY||a.beginY<=b.beginY&&b.beginY<=a.endY)}function g(a,b,c,d){var e={};return a>c?(e.beginX=c,e.endX=a):(e.beginX=a,e.endX=c),b>d?(e.beginY=d,e.endY=b):(e.beginY=b,e.endY=d),e}function h(a,b,c,d,e){var f=g(b,c,d,e);k.css({top:f.beginY+"px",left:f.beginX+"px",width:f.endX-f.beginX+"px",height:f.endY-f.beginY+"px"})}function i(a){a.preventDefault(),h(k,l,m,a.pageX,a.pageY);for(var c=b.msService.allSelectables,d=0;d<c.length;d++)f(g(offset(c[d][0]).left,offset(c[d][0]).top,offset(c[d][0]).left+c[d].prop("offsetWidth"),offset(c[d][0]).top+c[d].prop("offsetHeight")),g(l,m,a.pageX,a.pageY))?c[d].scope().isSelecting===!1&&(c[d].scope().isSelecting=!0,c[d].scope().$apply()):c[d].scope().isSelecting===!0&&(c[d].scope().isSelecting=!1,c[d].scope().$apply())}function j(c){c.preventDefault(),k.remove();for(var d=b.msService.allSelectables,e=0;e<d.length;e++)d[e].scope().isSelecting===!0&&(d[e].scope().isSelecting=!1,d[e].scope().isSelected=c.ctrlKey?!d[e].scope().isSelected:!0,d[e].scope().$apply());b.updateSelection(),a.off("mousemove",i),a.off("mouseup",j)}b.isSelectableZone=!0,"undefined"!=typeof d.continuousSelection&&(b.continuousSelection=b.msService.continuousSelection=!0);var k,l=0,m=0;c.on("mousedown",function(c){if(c.preventDefault(),!c.ctrlKey)for(var d=b.msService.allSelectables,e=0;e<d.length;e++)(d[e].scope().isSelecting===!0||d[e].scope().isSelected===!0)&&(d[e].scope().isSelecting=!1,d[e].scope().isSelected=!1,d[e].scope().$apply());l=c.pageX,m=c.pageY,k=angular.element("<div></div>").addClass("select-helper"),a.find("body").eq(0).append(k),a.on("mousemove",i),a.on("mouseup",j)})}}}]);