/*! angular-multiple-selection 0.0.3 */
function offset(a){var b,c={top:0,left:0},d=a&&a.ownerDocument;return b=d.documentElement,void 0!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect()),{top:c.top+(window.pageYOffset||b.scrollTop)-(b.clientTop||0),left:c.left+(window.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}}angular.module("multipleSelection",[]).directive("multipleSelectionItem",["$timeout",function(a){return{restrict:"A",require:["^multipleSelectionZone"],controller:function(a){},link:function(b,c,d,e){function f(){b.linkTriggered=!1,b.allSelectables=g.getAllSelectables(),b.itemData={},b.itemData.uri=d.multipleSelectionItem?b.$eval(d.multipleSelectionItem):Math.round(99999*Math.random()),b.itemData.id=b.allSelectables.length+"_"+b.itemData.uri,b.itemData.type=d.multiSelItemType&&"undefined"!=typeof d.multiSelItemType?b.$eval(d.multiSelItemType):"";var e={},f={};b.itemData.element||(b.itemData.element=[]),b.itemData.element.push(c),g.populate(b.itemData),b.$watchGroup([function(){return b.itemData.selecting},function(){return b.itemData.selected}],function(a){a[0]?c.addClass(h):c.removeClass(h),a[1]?c.addClass(i):c.removeClass(i)}),c.on("mousedown.multi-select",function(a,c){e={x:a.clientX,y:a.clientY},c&&"object"==typeof c&&(e={x:c.clientX,y:c.clientY}),g.childItemClicked=b.mouseDown=!0,(!g.enableItemDragSelection||b.itemData.selected)&&(a.preventDefault(),a.stopPropagation())}),c.on("mouseup.multi-select touchend.multi-select",function(a,c){return f={x:a.clientX,y:a.clientY},c&&"object"==typeof c&&(f={x:c.clientX,y:c.clientY},a.which=c.which),b.linkTriggered?void(b.linkTriggered=!1):void(1==a.which&&(g.continuousSelection?(e.x===f.x||e.y===f.y)&&(b.itemData.selected=!b.itemData.selected):b.itemData.selected?a.ctrlKey?b.itemData.selected=!1:g.deselectAll(b.itemData.id):(a.ctrlKey||g.isDragSelection||g.deselectAll(b.itemData.id),b.itemData.selected=!0),b.mouseDown=g.childItemClicked=g.isDragSelection=!1,b.linkTriggered=!1,g.updateSelectedData(b.itemData)))}),c.on("click mousedown mouseup touchstart touchend","a",function(c){"mousedown"===c.type&&(g.enableItemDragSelection&&c.stopPropagation(),b.linkTriggered=!0,a(function(){b.linkTriggered=!1},500)),"mouseup"===c.type&&a(function(){b.linkTriggered=!1},10)}),b.$on("$destroy",function(){g.remove(b.itemData)})}var g=e[0],h=g.selectingClass||"isSelecting",i=g.selectedClass||"isSelected";g.multipleSelectionZone===!1||"false"===g.multipleSelectionZone||f()}}}]).directive("multipleSelectionZone",["$document","$timeout","$parse",function(a,b,c){return{restrict:"A",scope:{selectedData:"=?",multipleSelectionZone:"@"},controller:function(a){function b(){a.allSelectables=[],c.selectingClass=a.selectingClass="",c.selectedClass=a.selectedClass="",c.continuousSelection=a.continuousSelection=!1,c.enableItemDragSelection=a.enableItemDragSelection=!1,c.isDragSelection=!1,c.childItemClicked=!1,c.selectItem=a.selectItem=function(b){_.where(a.allSelectables,{id:b})[0].selected=!1},c.getAllSelectables=a.getAllSelectables=function(){return a.allSelectables},c.getSelectedData=a.getSelectedData=function(){return a.selectedData},c.setSelectedData=a.setSelectedData=function(b){b="undefined"==typeof b?[]:b,a.selectedData=b},c.updateSelectedData=a.updateSelectedData=function(b){for(var c=!1,d=null,e=a.selectedData,f=0;f<e.length;f++)if(e[f].id==b.id){d=f,c=!0;break}b.selected&&!c?e.push(b):!b.selected&&c&&e.splice(d,1),a.selectedData=e},c.setAllSelected=a.setAllSelected=function(){for(var b=[],c=a.allSelectables,d=0;d<c.length;d++)_.where(a.allSelectables,{id:c[d].id})[0].selected&&b.push(_.where(a.allSelectables,{id:c[d].id})[0]);a.selectedData=b},c.populate=a.populate=function(b){a.allSelectables.push(b)},c.deselectAll=a.deselectAll=function(b){b=Array.isArray(b)?b:[b];var c=a.allSelectables;a.selectedData=[];for(var d=0;d<c.length;d++)"undefined"==typeof b||-1===b.indexOf(c[d].id)?(_.where(a.allSelectables,{id:c[d].id})[0].selecting=!1,_.where(a.allSelectables,{id:c[d].id})[0].selected=!1):(_.where(a.allSelectables,{id:b[b.indexOf(c[d].id)]})[0].selected=!0,a.selectedData.push(_.where(a.allSelectables,{id:b[b.indexOf(c[d].id)]})[0]))},c.selectAll=a.selectAll=function(){var b=a.allSelectables,c=[];if(b.length){for(var d=0;d<b.length;d++)_.where(a.allSelectables,{id:b[d].id})[0].selecting=!1,_.where(a.allSelectables,{id:b[d].id})[0].selected=!0,c.push(_.where(a.allSelectables,{id:b[d].id})[0]);a.selectedData=c}},c.isElemVisible=a.isElemVisible=function(a){var b=!0;return(a.prop("offsetWidth")<=0||a.prop("offsetHeight")<=0||offset(a[0]).left+a.prop("offsetWidth")<0||offset(a[0]).top+a.prop("offsetHeight")<0||!a.is(":visible")||parseFloat(a.css("opacity"))<=0||"none"===a.css("display"))&&(b=!1),b},c.remove=a.remove=function(b){a.allSelectables=_.reject(a.allSelectables,{id:b.id})},c.onLinkEvtTrigger=a.onLinkEvtTrigger=function(a){}}this.multipleSelectionZone=a.multipleSelectionZone;var c=this;"false"===a.multipleSelectionZone||a.multipleSelectionZone===!1||b()},link:function(c,d,e,f){function g(){function g(a,b){return(b.beginX<=a.beginX&&a.beginX<=b.endX||a.beginX<=b.beginX&&b.beginX<=a.endX)&&(b.beginY<=a.beginY&&a.beginY<=b.endY||a.beginY<=b.beginY&&b.beginY<=a.endY)}function h(a,b,c,d){var e={};return a>c?(e.beginX=c,e.endX=a):(e.beginX=a,e.endX=c),b>d?(e.beginY=d,e.endY=b):(e.beginY=b,e.endY=d),e}function i(a,b,c,d,e){var f=h(b,c,d,e);l.css({top:f.beginY+"px",left:f.beginX+"px",width:f.endX-f.beginX+"px",height:f.endY-f.beginY+"px"})}function j(a){function b(a){var b=0;return _.each(a,function(a){c.isElemVisible(a)&&g(h(offset(a[0]).left,offset(a[0]).top,offset(a[0]).left+a.prop("offsetWidth"),offset(a[0]).top+a.prop("offsetHeight")),h(m,n,e,f))&&b++}),b>0}var e=a.pageX;e=e<offset(d[0]).left?offset(d[0]).left:e,e=e>offset(d[0]).left+d.prop("offsetWidth")?offset(d[0]).left+d.prop("offsetWidth"):e;var f=a.pageY;f=f<offset(d[0]).top?offset(d[0]).top:f,f=f>offset(d[0]).top+d.prop("offsetHeight")?offset(d[0]).top+d.prop("offsetHeight"):f,i(l,m,n,e,f);for(var j=c.allSelectables,k=0;k<j.length;k++){_.where(c.allSelectables,{id:j[k].id});b(j[k].element)?_.where(c.allSelectables,{id:j[k].id})[0].selecting=!0:(_.where(c.allSelectables,{id:j[k].id})[0].selected=!1,_.where(c.allSelectables,{id:j[k].id})[0].selecting=!1)}}function k(b){b.preventDefault(),l.remove();for(var d=c.allSelectables,e=0;e<d.length;e++){var g=_.where(c.allSelectables,{id:d[e].id});_.where(c.allSelectables,{id:d[e].id})[0].selecting===!0&&(_.where(c.allSelectables,{id:d[e].id})[0].selecting=!1,_.where(c.allSelectables,{id:d[e].id})[0].selected=b.ctrlKey?!g.selected:!0,c.updateSelectedData(_.where(c.allSelectables,{id:d[e].id})[0])),f.isDragSelection=!1}f.childItemClicked&&(f.childItemClicked=!1),a.off("mousemove.multi-select",j),a.off("mouseup.multi-select",k)}c.isSelectableZone=!0,c.selectionZoneOffset=offset(d[0]),"undefined"!=typeof e.continuousSelection&&(f.continuousSelection=c.continuousSelection=!0),e.selectingClass&&"string"==typeof e.selectingClass&&(f.selectingClass=c.selectingClass=e.selectingClass),e.selectedClass&&"string"==typeof e.selectedClass&&(f.selectedClass=c.selectedClass=e.selectedClass),"undefined"!=typeof e.enableItemDragSelection&&(f.enableItemDragSelection=c.enableItemDragSelection=!0);var l,m=0,n=0;c.$watchCollection(function(){return c.selectedData},function(){_.each(c.allSelectables,function(a){var b=_.where(c.selectedData,{id:a.id});a.selected=b&&b.length}),c.selectedData&&c.selectedData.length>0&&b(function(){c.$emit("MULTISEL_UPDATED",c.selectedData)})}),c.$on("MULTISEL_SELECT_ALL",c.selectAll),c.$on("MULTISEL_SELECT_NONE",c.deselectAll),c.$on("MULTISEL_UPDATE",function(a,b){var d=_.where(c.allSelectables,{uri:b})[0].id;c.deselectAll(d)}),c.$on("MULTISEL_RESET_CLICKSTATE",function(){f.childItemClicked=!1}),d.on("mousedown.multi-select",function(b){b.preventDefault(),f.isDragSelection=!0,(!c.enableItemDragSelection&&!b.ctrlKey||c.enableItemDragSelection&&!f.childItemClicked&&!b.ctrlKey)&&c.deselectAll(),m=b.pageX,n=b.pageY,l=angular.element(".select-helper"),l.length||(l=angular.element("<div></div>").addClass("select-helper")),a.find("body").eq(0).append(l),a.on("mousemove.multi-select",j),a.on("mouseup.multi-select",k)}),c.$on("$destroy",function(){a.off("mousemove.multi-select",j),a.off("mouseup.multi-select",k)})}"false"===c.multipleSelectionZone||c.multipleSelectionZone===!1||g()}}}]);